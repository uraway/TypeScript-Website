{"version":3,"sources":["webpack:///./src/components/SuppressWhenTouch.tsx","webpack:///./src/components/devNav.tsx","webpack:///./src/pages/dev/twoslash.tsx","webpack:///../shiki-twoslash/src/utils.ts","webpack:///../shiki-twoslash/src/renderers/twoslash.ts","webpack:///../shiki-twoslash/src/parseCodeFenceInfo.ts","webpack:///./src/lib/isTouchDevice.ts"],"names":["SuppressWhenTouch","children","hideOnTouch","useEffect","isTouchDevice","suppressible","document","getElementById","firstChild","removeChild","h4","createElement","textContent","p","appendChild","id","DevNav","props","isActive","str","active","toLowerCase","className","style","display","href","withPrefix","Index","getLoaderScript","src","async","onload","re","global","require","config","paths","vs","sandbox","ignoreDuplicateModules","main","ts","sandboxEnv","a","_ts","parentNode","console","error","createTypeScriptSandbox","text","codeSamples","code","compilerOptions","domID","supportTwoslashCompilerOptions","editor","focus","window","createDefaultMapFromCDN","target","lzstring","mapWithLibFiles","runTwoslash","newContent","getText","set","newResults","twoslasher","tsModule","lzstringModule","fsMap","codeAsFakeShikiTokens","split","map","line","content","html","twoslashRenderer","results","innerHTML","innerText","extension","playgroundURL","err","failure","header","opener","name","startsWith","message","log","debouncedTwoslash","debounce","onDidChangeModelContent","setTimeout","querySelectorAll","forEach","button","classList","remove","codeElement","monaco","colorize","tabSize","then","newHTML","body","title","description","lang","marginTop","paddingTop","maxWidth","flex","blurb","role","height","onClick","e","contains","setText","paddingLeft","borderLeft","position","overflow","locale","createHighlightedString2","ranges","actions","hasErrors","r","classes","push","index","end","lsp","begin","slice","sort","l","action","idx","rem","newString","Math","abs","replaceTripleArrow","stripHTML","replace","table","toString","chr","lines","options","twoslash","codefenceMeta","meta","hasHighlight","Object","keys","find","key","includes","NaN","parseInt","hl","first","last","lastIndex","i","shouldHighlightLine","bg","fg","langId","errorsGroupedByLine","groupBy","errors","Map","staticQuickInfosGroupedByLine","staticQuickInfos","q","queriesGroupedByLine","queries","filePos","get","lspValues","length","hiClass","tokenPos","token","tokenContent","findTokenFunc","start","character","errorsInToken","filter","lspResponsesInToken","queriesInToken","allTokensByStart","range","kind","color","messages","escapeHtml","renderedMessage","join","codes","query","previousLine","previousLineWhitespace","exec","linePrefix","padStart","offset","queryTextWithPrefix","completions","lis","c","completionsPrefix","localeCompare","after","substr","kindModifiers","playgroundLink","list","keyGetter","item","collection","hasTouchScreen","navigator","maxTouchPoints","msMaxTouchPoints","mQ","matchMedia","media","matches","UA","userAgent","test"],"mappings":"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","file":"component---src-pages-dev-twoslash-tsx-1b33e1206f5b9aedebe1.js","sourcesContent":["import React, { useEffect } from \"react\"\nimport { isTouchDevice } from \"../lib/isTouchDevice\"\n\n/**\n * A React component which will remove its children (at runtime!)\n * from the hierarchy if we're on a touch device\n */\nexport const SuppressWhenTouch = ({ children, hideOnTouch }: any) => {\n\n  useEffect(() => {\n    if (isTouchDevice()) {\n      // It's touch, so let's kill the content in the child and \n      // replace it with a message that this section isn't good for mobile\n      const suppressible = document.getElementById(\"touch-suppressible\")!\n      while (suppressible.firstChild) {\n        suppressible.removeChild(suppressible.firstChild)\n      }\n\n      if (hideOnTouch) return\n\n      const h4 = document.createElement(\"h4\")\n      h4.textContent = \"Section best on a computer\"\n\n      const p = document.createElement(\"p\")\n      p.textContent = \"This part of the site does not run well on a touch-oriented browser. We recommend switching to a computer to carry on.\"\n\n      suppressible.appendChild(h4)\n      suppressible.appendChild(p)\n    }\n\n  }, [])\n  return (\n    <div id=\"touch-suppressible\">\n      {children}\n    </div>)\n}\n","import * as React from \"react\"\nimport { withPrefix } from \"gatsby\"\n\ninterface DevNavProps {\n  active?: string\n}\n\nexport const DevNav = (props: DevNavProps) => {\n  const isActive = (str) =>\n    props.active && props.active.toLowerCase() === str ? \"active\" : \"\"\n\n  return <nav className=\"navbar-sub dev-tools\">\n    <ul className=\"nav\">\n      <li className=\"name\"><h3>Developer Tools</h3></li>\n      <li style={{ display: \"none\" }}>\n        <a className={isActive(\"compiler api\")} href={withPrefix(\"/dev/compiler\")}>Compiler API</a>\n      </li>\n      <li>\n        <a className={isActive(\"sandbox\")} href={withPrefix(\"/dev/sandbox\")}>Sandbox</a>\n      </li>\n      <li>\n        <a className={isActive(\"twoslash\")} href={withPrefix(\"/dev/twoslash\")}>Twoslash</a>\n      </li>\n      <li>\n        <a className={isActive(\"typescript vfs\")} href={withPrefix(\"/dev/typescript-vfs\")}>TypeScript VFS</a>\n      </li>\n      <li>\n        <a className={isActive(\"playground plugins\")} href={withPrefix(\"/dev/playground-plugins\")}>Playground Plugins</a>\n      </li>\n      <li>\n        <a className={isActive(\"bug workbench\")} href={withPrefix(\"/dev/bug-workbench\")}>Bug Workbench</a>\n      </li>\n    </ul>\n  </nav >\n}\n","import React, { useEffect } from \"react\"\nimport { Layout } from \"../../components/layout\"\nimport { withPrefix, graphql } from \"gatsby\"\nimport { twoslasher } from \"@typescript/twoslash\"\nimport { createDefaultMapFromCDN } from \"@typescript/vfs\"\nimport { twoslashRenderer } from \"shiki-twoslash/src/renderers/twoslash\"\nimport { debounce } from \"ts-debounce\"\n\nimport \"./dev.scss\"\nimport { Intl } from \"../../components/Intl\"\nimport { DevNav } from \"../../components/devNav\"\nimport { isTouchDevice } from \"../../lib/isTouchDevice\"\nimport { SuppressWhenTouch } from \"../../components/SuppressWhenTouch\"\n\n/** Note: to run all the web infra in debug, run:\n  localStorage.debug = '*'\n\n  to remove logging: localStorage.debug = undefined\n */\n\ntype Props = {}\n\nconst Index: React.FC<Props> = props => {\n  useEffect(() => {\n    // No monaco for touch\n    if (isTouchDevice()) {\n      return\n    }\n\n    const getLoaderScript = document.createElement(\"script\")\n    getLoaderScript.src = withPrefix(\"/js/vs.loader.js\")\n    getLoaderScript.async = true\n    getLoaderScript.onload = () => {\n      // @ts-ignore\n      const re: any = global.require\n\n      re.config({\n        paths: {\n          vs: \"https://typescript.azureedge.net/cdn/4.0.5/monaco/min/vs\",\n          sandbox: withPrefix(\"/js/sandbox\"),\n        },\n        ignoreDuplicateModules: [\"vs/editor/editor.main\"],\n      })\n\n      re(\n        [\n          \"vs/editor/editor.main\",\n          \"vs/language/typescript/tsWorker\",\n          \"sandbox/index\",\n        ],\n        async (\n          main: typeof import(\"monaco-editor\"),\n          ts: typeof import(\"typescript\"),\n          sandboxEnv: typeof import(\"@typescript/sandbox\")\n        ) => {\n          // This triggers making \"ts\" available in the global scope\n          re([\"vs/language/typescript/lib/typescriptServices\"], async _ts => {\n            const ts = (global as any).ts\n            const isOK = main && ts && sandboxEnv\n\n            if (isOK) {\n              document\n                .getElementById(\"loader\")!\n                .parentNode?.removeChild(document.getElementById(\"loader\")!)\n            } else {\n              console.error(\n                \"Error: main\",\n                !!main,\n                \"ts\",\n                !!ts,\n                \"sandbox\",\n                !!sandboxEnv\n              )\n            }\n\n            document.getElementById(\"monaco-editor-embed\")!.style.display =\n              \"block\"\n            const sandbox = await sandboxEnv.createTypeScriptSandbox(\n              {\n                text: codeSamples[0].code,\n                compilerOptions: {},\n                domID: \"monaco-editor-embed\",\n                supportTwoslashCompilerOptions: true,\n              },\n              main,\n              ts\n            )\n            sandbox.editor.focus()\n\n            // @ts-ignore\n            window.sandbox = sandbox\n\n            const mapWithLibFiles = await createDefaultMapFromCDN(\n              { target: 3 },\n              \"3.7.3\",\n              true,\n              ts,\n              sandbox.lzstring as any\n            )\n\n            const runTwoslash = () => {\n              const newContent = sandbox.getText()\n              mapWithLibFiles.set(\"index.ts\", newContent)\n\n              try {\n                const newResults = twoslasher(newContent, \"tsx\", {\n                  tsModule: ts,\n                  lzstringModule: sandbox.lzstring as any,\n                  fsMap: mapWithLibFiles,\n                })\n                const codeAsFakeShikiTokens = newResults.code\n                  .split(\"\\n\")\n                  .map(line => [{ content: line }])\n                const html = twoslashRenderer(\n                  codeAsFakeShikiTokens,\n                  {},\n                  newResults,\n                  {}\n                )\n\n                const results = document.getElementById(\"twoslash-results\")!\n\n                document.getElementById(\"twoslash-failure\")!.style.display =\n                  \"none\"\n                document.getElementById(\"twoslash-results\")!.innerHTML = html\n\n                // Remove all the kids\n                while (results.firstChild) {\n                  results.removeChild(results.firstChild)\n                }\n\n                const p = document.createElement(\"p\")\n                p.innerText = newResults.extension\n                p.className = \"extension\"\n\n                const code = document.createElement(\"div\")\n                code.innerHTML = html\n\n                const a = document.createElement(\"a\")\n                a.innerText = \"Playground\"\n                a.href = newResults.playgroundURL\n\n                results.appendChild(p)\n                results.appendChild(code)\n                results.appendChild(a)\n              } catch (error) {\n                const err = error as Error\n                const failure = document.getElementById(\"twoslash-failure\")\n\n                if (!failure) return\n                failure.style.display = \"block\"\n\n                while (failure.firstChild) {\n                  failure.removeChild(failure.firstChild)\n                }\n\n                const content = document.createElement(\"div\")\n                content.className = \"err-content\"\n\n                const header = document.createElement(\"h3\")\n                header.textContent = \"Exception Raised\"\n\n                const text = document.createElement(\"p\")\n                const opener = err.name.startsWith(\"Error\")\n                  ? err.name.split(\"Error\")[1]\n                  : err.name\n                text.textContent = opener + err.message.split(\"## Code\")[0]\n\n                content.appendChild(header)\n                content.appendChild(text)\n                failure.appendChild(content)\n\n                console.log(error)\n              }\n            }\n\n            const debouncedTwoslash = debounce(runTwoslash, 500)\n            sandbox.editor.onDidChangeModelContent(debouncedTwoslash)\n            runTwoslash()\n\n            setTimeout(() => {\n              document\n                .querySelectorAll(\"#example-buttons .disabled\")\n                .forEach(button => {\n                  button.classList.remove(\"disabled\")\n                })\n\n              document.querySelectorAll(\".html-code\").forEach(codeElement => {\n                sandbox.monaco.editor\n                  .colorize(codeElement.textContent || \"\", \"html\", {\n                    tabSize: 2,\n                  })\n                  .then(newHTML => {\n                    codeElement.innerHTML = newHTML\n                  })\n              })\n\n              document.querySelectorAll(\".ts-code\").forEach(codeElement => {\n                sandbox.monaco.editor\n                  .colorize(codeElement.textContent || \"\", \"typescript\", {\n                    tabSize: 2,\n                  })\n                  .then(newHTML => {\n                    codeElement.innerHTML = newHTML\n                  })\n              })\n            }, 300)\n          })\n        }\n      )\n    }\n\n    document.body.appendChild(getLoaderScript)\n  }, [])\n\n  return (\n    <>\n      <Layout\n        title=\"Developers - Twoslash Code Samples\"\n        description=\"Learn about the TypeScript code sample library twoslash. Used for transpiling, providing hover to identifiers and compiler-driven error states.\"\n        lang=\"en\"\n      >\n        <div id=\"dev\">\n          <DevNav active=\"twoslash\" />\n          <div className=\"raised content main-content-block\">\n            <div className=\"split-fifty\">\n              <div>\n                <h1 style={{ marginTop: \"20px\" }}>TypeScript Twoslash</h1>\n                <p>\n                  A markup format for TypeScript code, ideal for creating\n                  self-contained code samples which let the TypeScript compiler\n                  do the extra leg-work.\n                </p>\n                <p>If you know TypeScript, you basically know twoslash.</p>\n                <p>\n                  Twoslash adds the ability to declare tsconfig options inline,\n                  split a sample into multiple files and a few other useful\n                  commands. You can see the full API{\" \"}\n                  <a href=\"https://github.com/microsoft/TypeScript-Website/tree/v2/packages/ts-twoslasher\">\n                    inside the README\n                  </a>\n                </p>\n              </div>\n              <div style={{ paddingTop: \"4.5rem\" }}>\n                <p>The Twoslash markup language helps with:</p>\n                <ul>\n                  <li>\n                    Enforcing accurate errors from a TypeScript code sample, and\n                    leaving the messaging to the compiler\n                  </li>\n                  <li>Splitting a code sample to hide distracting code</li>\n                  <li>\n                    Declaratively highlighting symbols in your code sample\n                  </li>\n                  <li>\n                    Replacing code with the results of transpilation to\n                    different files, or ancillary files like .d.ts or .map files\n                  </li>\n                  <li>Handle multi-file imports in a single code sample</li>\n                  <li>Creating a playground link for the code</li>\n                </ul>\n              </div>\n            </div>\n          </div>\n\n          <div\n            className=\"raised content main-content-block\"\n            style={{ maxWidth: \"90%\" }}\n          >\n            <div className=\"fivehundred\" style={{ flex: 1 }}>\n              <SuppressWhenTouch>\n                <h3 style={{ marginTop: \"0\" }}>Markup</h3>\n                <p id=\"exampleBlurb\">{codeSamples[0].blurb}</p>\n                <div id=\"loader\">\n                  <div className=\"lds-grid\">\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                    <div></div>\n                  </div>\n                  <p id=\"loading-message\" role=\"status\">\n                    Downloading Sandbox...\n                  </p>\n                </div>\n                <div\n                  style={{ height: \"300px\", display: \"none\" }}\n                  id=\"monaco-editor-embed\"\n                />\n                <div id=\"example-buttons\">\n                  {codeSamples.map(code => {\n                    const setExample = e => {\n                      if (e.target.classList.contains(\"disabled\")) return\n\n                      document.getElementById(\"exampleBlurb\")!.innerText =\n                        code.blurb\n                      // @ts-ignore\n                      window.sandbox.setText(code.code)\n                    }\n                    return (\n                      <div className=\"button disabled\" onClick={setExample}>\n                        {code.name}\n                      </div>\n                    )\n                  })}\n                </div>\n              </SuppressWhenTouch>\n            </div>\n\n            <div\n              style={{\n                paddingLeft: \"20px\",\n                borderLeft: \"1px solid gray\",\n                position: \"relative\",\n                flex: 1,\n                overflow: \"auto\",\n              }}\n            >\n              <SuppressWhenTouch>\n                <h3 style={{ marginTop: \"0\" }}>Results</h3>\n\n                <div id=\"twoslash-results\" />\n                <div id=\"twoslash-failure\" />\n              </SuppressWhenTouch>\n            </div>\n          </div>\n\n          <div className=\"raised main-content-block\">\n            <h2>Usage</h2>\n            <p>\n              Twoslash's usage guide is available on the npm README at{\" \"}\n              <a href=\"https://www.npmjs.com/package/@typescript/twoslash\">\n                <code>@typescript/twoslash</code>\n              </a>\n              .\n            </p>\n          </div>\n        </div>\n      </Layout>\n    </>\n  )\n}\n\nexport default (props: Props) => (\n  <Intl locale=\"en\">\n    <Index {...props} />\n  </Intl>\n)\n\n// prettier-ignore\nconst codeSamples = [\n  {\n    name: \"Highlights runtime types\",\n    blurb: \"See how TS Twoslash will grab the highlight information for identifiers in your code\",\n    code: `// @errors: 2532\ndeclare const quantumString: string | undefined;\n\n// Right now this string is in two states, hover below to see\nquantumString\n  \nif (quantumString) {\n  // However, in here we now have a different type\n  // you can verify by hovering below\n  quantumString.length;\n}\n    `\n  },\n  {\n    name: \"Show Errors\",\n    blurb: \"Twoslash will help highlight compiler error messages\",\n    code: `// @errors: 7006\nfunction fn(s) {\n  console.log(s.subtr(3))\n}\n\nfn(42)`\n  }, {\n    name: \"Set Compiler Flags\",\n    blurb: \"You can define compiler flags inline in a code sample which are removed from the output\",\n    code: `// @noImplicitAny: false\n// This will not throw because of the noImplicitAny\nfunction fn(s) {\n  console.log(s.subtr(3))\n}\n\nfn(42);`\n  }, {\n    name: \"Trims code\",\n    blurb: \"You can write code to help it compile in the sample which is hidden in the output\",\n    code: `interface IdLabel {id: number, /* some fields */ }\ninterface NameLabel {name: string, /* other fields */ }\ntype NameOrId<T extends number | string> = T extends number ? IdLabel : NameLabel;\n// This comment should not be included\n\n// ---cut---\nfunction createLabel<T extends number | string>(idOrName: T): NameOrId<T> {\n  throw \"unimplemented\"\n}\n\nlet a = createLabel(\"typescript\");`\n  },\n  {\n    name: \"Show the JS\",\n    blurb: \"Use @showEmit to show the JS files\",\n    code: `// @showEmit\nexport function getStringLength(value: string) {\n  return value\n}\n`},\n  {\n    name: \"Show the DTS\",\n    blurb: \"Use @showEmittedFile to set the d.ts file to be the result code\",\n    code: `// @declaration: true\n// @showEmit\n// @showEmittedFile: index.d.ts\n/**\n * Gets the length of a string\n * @param value a string\n */\nexport function getStringLength(value: string) {\n  return value\n}\n`},\n  {\n    name: \"Highlights\",\n    blurb: \"Highlight some code in the editor\",\n    code: `function greet(person: string, date: Date) {\n  console.log(\\`Hello \\${person}, today is \\${date.toDateString()}!\\`);\n}\n\ngreet(\"Maddison\", new Date());\n//                ^^^^^^^^^^\n`\n  }\n]\n","type Range = {\n  begin: number\n  end: number\n  text?: string\n  count?: number\n  tooltip?: string[]\n  classes?: string\n  lsp?: string\n}\n\nconst splice = (str: string, idx: number, rem: number, newString: string) =>\n  str.slice(0, idx) + newString + str.slice(idx + Math.abs(rem))\n\n/**\n * We're given the text which lives inside the token, and this function will\n * annotate it with twoslash metadata\n */\nexport function createHighlightedString2(ranges: Range[], text: string) {\n  const actions = [] as { text: string; index: number }[]\n  let hasErrors = false\n\n  // Why the weird chars? We need to make sure that generic syntax isn't\n  // interpreted as html tags - to do that we need to switch out < to &lt; - *but*\n  // making that transition changes the indexes because it's gone from 1 char to 4 chars\n\n  // So, use an obscure character to indicate a real < for HTML, then switch it after\n\n  ranges.forEach(r => {\n    if (r.classes === \"lsp\") {\n      actions.push({ text: \"⇍/data-lsp⇏\", index: r.end })\n      actions.push({ text: `⇍data-lsp lsp=⇯${r.lsp || \"\"}⇯⇏`, index: r.begin })\n    } else if (r.classes === \"err\") {\n      hasErrors = true\n    } else if (r.classes === \"query\") {\n      actions.push({ text: \"⇍/data-highlight⇏\", index: r.end })\n      actions.push({ text: `⇍data-highlight'⇏`, index: r.begin })\n    }\n  })\n\n  let html = (\" \" + text).slice(1)\n\n  // Apply all the edits\n  actions\n    .sort((l, r) => r.index - l.index)\n    .forEach(action => {\n      html = splice(html, action.index, 0, action.text)\n    })\n\n  if (hasErrors) html = `⇍data-err⇏${html}⇍/data-err⇏`\n\n  return replaceTripleArrow(stripHTML(html))\n}\n\nexport const subTripleArrow = (str: string) => str.replace(/</g, \"⇍\").replace(/>/g, \"⇏\").replace(/'/g, \"⇯\")\nexport const replaceTripleArrow = (str: string) => str.replace(/⇍/g, \"<\").replace(/⇏/g, \">\").replace(/⇯/g, \"'\")\nexport const replaceTripleArrowEncoded = (str: string) =>\n  str.replace(/⇍/g, \"&lt;\").replace(/⇏/g, \"&gt;\").replace(/⇯/g, \"&apos;\")\n\nexport function stripHTML(text: string) {\n  var table: any = {\n    \"<\": \"lt\",\n    '\"': \"quot\",\n    \"'\": \"apos\",\n    \"&\": \"amp\",\n    \"\\r\": \"#10\",\n    \"\\n\": \"#13\",\n  }\n\n  return text.toString().replace(/[<\"'\\r\\n&]/g, function (chr) {\n    return \"&\" + table[chr] + \";\"\n  })\n}\n\nexport function escapeHtml(html: string) {\n  return html.replace(/</g, \"&lt;\").replace(/>/g, \"&gt;\")\n}\n","type Lines = import(\"shiki\").IThemedToken[][]\ntype TwoSlash = import(\"@typescript/twoslash\").TwoSlashReturn\n\nimport { shouldBeHighlightable, shouldHighlightLine } from \"../parseCodeFenceInfo\"\nimport { stripHTML, createHighlightedString2, subTripleArrow, replaceTripleArrowEncoded, escapeHtml } from \"../utils\"\nimport { HtmlRendererOptions } from \"./plain\"\n\n// OK, so - this is just straight up complex code.\n\n// What we're trying to do is merge two sets of information into a single tree for HTML\n\n// 1: Syntax highlight info from shiki\n// 2: Twoslash metadata like errors, identifiers etc\n\n// Because shiki gives use a set of lines to work from, then the first thing which happens\n// is converting twoslash data into the same format.\n\n// Things which make it hard:\n//\n// - Twoslash results can be cut, so sometimes there is edge cases between twoslash results\n// - Twoslash results can be multi-file\n// - the DOM requires a flattened graph of html elements\n//\n\nexport function twoslashRenderer(lines: Lines, options: HtmlRendererOptions, twoslash: TwoSlash, codefenceMeta: any) {\n  let html = \"\"\n\n  const hasHighlight = shouldBeHighlightable(codefenceMeta)\n  const hl = shouldHighlightLine(codefenceMeta)\n  const bg = options.bg || \"#fff\"\n  const fg = options.fg || \"black\"\n\n  html += `<pre class=\"shiki twoslash lsp\" style=\"background-color: ${bg}; color: ${fg}\">`\n  if (options.langId) {\n    html += `<div class=\"language-id\">${options.langId}</div>`\n  }\n  html += `<div class='code-container'><code>`\n\n  const errorsGroupedByLine = groupBy(twoslash.errors, e => e.line) || new Map()\n  const staticQuickInfosGroupedByLine = groupBy(twoslash.staticQuickInfos, q => q.line) || new Map()\n  // A query is always about the line above it!\n  const queriesGroupedByLine = groupBy(twoslash.queries, q => q.line - 1) || new Map()\n\n  /**\n   * This is the index of the original twoslash code reference, it is not\n   * related to the HTML output\n   */\n  let filePos = 0\n\n  lines.forEach((l, i) => {\n    const errors = errorsGroupedByLine.get(i) || []\n    const lspValues = staticQuickInfosGroupedByLine.get(i) || []\n    const queries = queriesGroupedByLine.get(i) || []\n\n    if (l.length === 0 && i === 0) {\n      // Skip the first newline if it's blank\n      filePos += 1\n    } else if (l.length === 0) {\n      filePos += 1\n      html += `\\n`\n    } else {\n      const hiClass = hasHighlight ? (hl(i) ? \" highlight\" : \" dim\") : \"\"\n      const prefix = `<div class='line${hiClass}'>`\n      html += prefix\n\n      // Keep track of the position of the current token in a line so we can match it up to the\n      // errors and lang serv identifiers\n      let tokenPos = 0\n\n      l.forEach(token => {\n        let tokenContent = \"\"\n        // Underlining particular words\n        const findTokenFunc = (start: number) => (e: any) =>\n          start <= e.character && start + token.content.length >= e.character + e.length\n\n        const findTokenDebug = (start: number) => (e: any) => {\n          const result = start <= e.character && start + token.content.length >= e.character + e.length\n          // prettier-ignore\n          console.log(result, start, '<=', e.character, '&&', start + token.content.length, '>=', e.character + e.length)\n          if (result) {\n            console.log(\"Found:\", e)\n            console.log(\"Inside:\", token)\n          }\n          return result\n        }\n\n        const errorsInToken = errors.filter(findTokenFunc(tokenPos))\n        const lspResponsesInToken = lspValues.filter(findTokenFunc(tokenPos))\n        const queriesInToken = queries.filter(findTokenFunc(tokenPos))\n\n        const allTokens = [...errorsInToken, ...lspResponsesInToken, ...queriesInToken]\n        const allTokensByStart = allTokens.sort((l, r) => {\n          return (l.start || 0) - (r.start || 0)\n        })\n\n        if (allTokensByStart.length) {\n          const ranges = allTokensByStart.map(token => {\n            const range: any = {\n              begin: token.start! - filePos,\n              end: token.start! + token.length! - filePos,\n            }\n\n            // prettier-ignore\n            if (range.begin < 0 || range.end < 0) {\n              // prettier-ignore\n              // throw new Error(`The begin range of a token is at a minus location, filePos:${filePos} current token: ${JSON.stringify(token, null, '  ')}\\n result: ${JSON.stringify(range, null, '  ')}`)\n            }\n\n            if (\"renderedMessage\" in token) range.classes = \"err\"\n            if (\"kind\" in token) range.classes = token.kind\n            if (\"targetString\" in token) {\n              range.classes = \"lsp\"\n              range[\"lsp\"] = stripHTML(token.text)\n            }\n            return range\n          })\n\n          tokenContent += createHighlightedString2(ranges, token.content)\n        } else {\n          tokenContent += subTripleArrow(token.content)\n        }\n\n        html += `<span style=\"color: ${token.color}\">${tokenContent}</span>`\n        tokenPos += token.content.length\n        filePos += token.content.length\n      })\n\n      html += `</div>`\n      // This is the \\n which the </div> represents\n      filePos += 1\n    }\n\n    // Adding error messages to the line after\n    if (errors.length) {\n      const messages = errors.map(e => escapeHtml(e.renderedMessage)).join(\"</br>\")\n      const codes = errors.map(e => e.code).join(\"<br/>\")\n      html += `<span class=\"error\"><span>${messages}</span><span class=\"code\">${codes}</span></span>`\n      html += `<span class=\"error-behind\">${messages}</span>`\n    }\n\n    // Add queries to the next line\n    if (queries.length) {\n      queries.forEach(query => {\n        switch (query.kind) {\n          case \"query\": {\n            const previousLine = (lines[i - 1] || [])[0]?.content || \"\"\n            const previousLineWhitespace = previousLine.slice(0, /\\S/.exec(previousLine)?.index || 0)\n            // prettier-ignore\n            const linePrefix = previousLineWhitespace + \"//\" + \"\".padStart(query.offset - 2 - previousLineWhitespace.length)\n            // prettier-ignore\n            const queryTextWithPrefix = query.text?.split(\"\\n\").map((l, i) => i !== 0 ? linePrefix + l : l).join(\"\\n\")\n            html += `<span class='query'>${linePrefix + \"^ = \" + queryTextWithPrefix}</span>`\n            break\n          }\n\n          case \"completions\": {\n            if (!query.completions) {\n              html += `<span class='query'>${\"//\" + \"\".padStart(query.offset - 2) + \"^ - No completions found\"}</span>`\n            } else {\n              const prefixed = query.completions.filter(c => c.name.startsWith(query.completionsPrefix || \"____\"))\n\n              const lis = prefixed\n                .sort((l, r) => l.name.localeCompare(r.name))\n                .map(c => {\n                  const after = c.name.substr(query.completionsPrefix?.length || 0)\n                  const name = `<span><span class='result-found'>${query.completionsPrefix || \"\"}</span>${after}<span>`\n                  const isDeprecated = c.kindModifiers?.split(\",\").includes(\"deprecated\")\n                  const liClass = isDeprecated ? \"deprecated\" : \"\"\n                  return `<li class='${liClass}'>${name}</li>`\n                })\n                .join(\"\")\n              html +=\n                \"\".padStart(query.offset) + `<span class='inline-completions'><ul class='dropdown'>${lis}</ul></span>`\n            }\n          }\n        }\n      })\n      html += \"\\n\"\n    }\n  })\n  html = replaceTripleArrowEncoded(html.replace(/\\n*$/, \"\")) // Get rid of final new lines\n  const playgroundLink = `<a href='${twoslash.playgroundURL}'>Try</a>`\n  html += `</code>${playgroundLink}</div></pre>`\n\n  return html\n}\n\n/** Returns a map where all the keys are the value in keyGetter  */\nfunction groupBy<T>(list: T[], keyGetter: (obj: any) => number) {\n  const map = new Map<number, T[]>()\n  list.forEach(item => {\n    const key = keyGetter(item)\n    const collection = map.get(key)\n    if (!collection) {\n      map.set(key, [item])\n    } else {\n      collection.push(item)\n    }\n  })\n  return map\n}\n","// Based on https://github.com/andrewbranch/gatsby-remark-vscode/blob/7bf5c036a58652c1f45d27c5874557f7b531102c/src/index.js\n// which is MIT https://github.com/andrewbranch/gatsby-remark-vscode/blob/7bf5c036a58652c1f45d27c5874557f7b531102c/LICENSE\n// Only difference is conversion to TypeScript, and a replace at the top\n\nconst identifierPattern = /[a-z0-9-–—_+#]/i\nconst triviaPattern = /\\s/\nconst startOfNumberPattern = /[0-9-.]/\nconst numberPattern = /[0-9-.e]/\n\nfunction testRegex(input: string, pattern: RegExp) {\n  if (input === undefined) return false\n  return pattern.test(input)\n}\n\n/** Takes the language and a meta-string and offers a useful object for looking at params */\nexport function parseCodeFenceInfo(lang: string, fullMetaString: string) {\n  // Heh\n  const metaString = fullMetaString.replace(\"twoslash\", \"\")\n  let pos = 0\n  let meta = {}\n  let languageName = \"\"\n  const input = [lang, metaString].filter(Boolean).join(\" \")\n  skipTrivia()\n  if (!isEnd() && current() !== \"{\") {\n    languageName = parseIdentifier()\n  }\n  const languageNameEnd = pos\n  skipTrivia()\n  if (!isEnd() && current() === \"{\") {\n    meta = parseObject()\n  }\n\n  if (!isEnd() && languageNameEnd === pos) {\n    return fail(`Invalid character in language name: '${current()}'`)\n  }\n\n  return { languageName, meta }\n\n  function current(): string {\n    if (isEnd()) {\n      return fail(\"Unexpected end of input\")\n    }\n    return input[pos]\n  }\n\n  function isEnd() {\n    return pos >= input.length\n  }\n\n  function fail(message: string): never {\n    throw new Error(`Failed parsing code fence header '${input}' at position ${pos}: ${message}`)\n  }\n\n  function scanExpected(expected: string): void {\n    if (isEnd() || current() !== expected) {\n      return fail(`Expected '${expected}'`)\n    }\n    pos++\n  }\n\n  function parseIdentifier(errorMessage = \"Expected identifier, but got nothing\") {\n    let identifier = \"\"\n    while (!isEnd() && testRegex(current(), identifierPattern)) {\n      identifier += current()\n      pos++\n    }\n    if (!identifier) {\n      return fail(errorMessage)\n    }\n    return identifier\n  }\n\n  function skipTrivia() {\n    while (!isEnd() && testRegex(current(), triviaPattern)) pos++\n  }\n\n  function parseChar() {\n    let char = current()\n    if (char === \"\\\\\") {\n      pos++\n      char += current()\n    }\n    pos++\n    return char\n  }\n\n  function parseString() {\n    let str = \"\"\n    const quote = current()\n    pos++\n    while (true) {\n      const char = parseChar()\n      if (char === quote) break\n      str += char.replace(/\\\\/, \"\")\n    }\n    return str\n  }\n\n  function parseNumber() {\n    let numStr = current()\n    pos++\n    while (!isEnd() && testRegex(current(), numberPattern)) {\n      numStr += current()\n      pos++\n    }\n    return parseFloat(numStr)\n  }\n\n  function parseBoolean() {\n    const identifier = parseIdentifier(\"Expected expression, but got nothing\")\n    switch (identifier) {\n      case \"true\":\n        return true\n      case \"false\":\n        return false\n      case \"\":\n        return fail(\"Expected expression, but got nothing\")\n      default:\n        return fail(`Unrecognized input '${identifier}'`)\n    }\n  }\n\n  function parseExpression() {\n    switch (current()) {\n      case \"{\":\n        return parseObject()\n      case `'`:\n      case '\"':\n        return parseString()\n    }\n    if (testRegex(current(), startOfNumberPattern)) {\n      return parseNumber()\n    }\n    return parseBoolean()\n  }\n\n  function parseObject() {\n    let obj: any = {}\n    scanExpected(\"{\")\n    skipTrivia()\n    while (!isEnd() && current() !== \"}\") {\n      const key = parseIdentifier()\n\n      let value: any = true\n      skipTrivia()\n      if (current() === \":\") {\n        pos++\n        skipTrivia()\n        value = parseExpression()\n        skipTrivia()\n      }\n      obj[key] = value\n      if (current() === \",\") pos++\n      skipTrivia()\n    }\n    scanExpected(\"}\")\n    return obj\n  }\n}\n\n/** Does anything in the object imply that we should highlight any lines? */\nexport const shouldBeHighlightable = (meta: any) => {\n  return !!Object.keys(meta).find(key => {\n    if (key.includes(\"-\")) return true\n    if (parseInt(key) !== NaN) return true\n    return false\n  })\n}\n\n/** Returns a func for figuring out if this line should be highlighted */\nexport const shouldHighlightLine = (meta: any) => {\n  const lines: number[] = []\n  Object.keys(meta).find(key => {\n    if (parseInt(key) !== NaN) lines.push(parseInt(key))\n    if (key.includes(\"-\")) {\n      const [first, last] = key.split(\"-\")\n      const lastIndex = parseInt(last) + 1\n      for (let i = parseInt(first); i < lastIndex; i++) {\n        lines.push(i)\n      }\n    }\n  })\n\n  return (line: number) => lines.includes(line)\n}\n","/** Based on https://developer.mozilla.org/docs/Web/HTTP/Browser_detection_using_the_user_agent */\nexport function isTouchDevice() {\n  var hasTouchScreen = false\n  if (\"maxTouchPoints\" in navigator) {\n    hasTouchScreen = navigator.maxTouchPoints > 0\n  } else if (\"msMaxTouchPoints\" in navigator) {\n    // @ts-ignore\n    hasTouchScreen = navigator.msMaxTouchPoints > 0\n  } else {\n    var mQ =\n      typeof window !== \"undefined\" &&\n      window.matchMedia &&\n      matchMedia(\"(pointer:coarse)\")\n    if (mQ && mQ.media === \"(pointer:coarse)\") {\n      hasTouchScreen = !!mQ.matches\n    } else if (\"orientation\" in window) {\n      hasTouchScreen = true // deprecated, but good fallback\n    } else {\n      // Only as a last resort, fall back to user agent sniffing\n      // @ts-ignore\n      var UA = navigator.userAgent\n      hasTouchScreen =\n        /\\b(BlackBerry|webOS|iPhone|IEMobile)\\b/i.test(UA) ||\n        /\\b(Android|Windows Phone|iPad|iPod)\\b/i.test(UA)\n    }\n  }\n  return hasTouchScreen\n}\n"],"sourceRoot":""}